# アプリ作成

Kiro CLI を使用して Todo アプリを実装していきます。

## セットアップ

**作業目安：15分**

### フレームワークの確認（準備済み）

本ワークショップで使用するフレームワーク設定がセットアップされています。

<details>

下記セットアップコマンドがすでに実行されています。

本ワークショップでは実行しなくて大丈夫です。

```shell
# vite - react のセットアップ
npm create vite@latest todo-app -- --template react-ts

# amplify のセットアップ
npm create amplify@latest -- --template react-vite
```

</details>

以下を確認してください。

1. `todo-app/src` ディレクトリが存在する：フロントエンドコード
2. `todo-app/amplify` ディレクトリが存在する：バックエンドコード

### 依存関係のインストール

アプリケーション作成に必要な JavaScript ライブラリをインストールします。

```shell
# 新しいターミナルを起動
cd /workspaces/amplify-gen2-workshop/todo-app
npm install
```

> [!NOTE]
>
> リポジトリ名を `amplify-gen2-workshop` 以外で作成された場合は、`/workspaces/<リポジトリ名>/todo-app` と適宜読み替えてください。

### CDK Bootstrap

Amplify Gen2 は裏側で CDK を利用します。

CDK を初めて利用する AWS 環境・リージョンでは CDK Bootstrap という処理が必要です。

[CDK Bootstrap とは？](https://docs.aws.amazon.com/ja_jp/cdk/v2/guide/bootstrapping-env.html)

まだの環境であれば、[AWS マネージメントコンソール](https://us-east-1.console.aws.amazon.com/amplify/create/bootstrap?region=us-east-1)にアクセスして Bootstrap を実行してください。

> [!NOTE]
>
> 実行するリージョンごとに Bootstrap を実行する必要があります。
>
> バージニア北部リージョンにて CDK を利用したことがない場合は、他のリージョンで作業した実績があったとしても、本作業を実施する必要があります。

5 分程度かかりますので、お待ちください。

`CDKToolkit は us-east-1 リージョンですでに正常にセットアップされています。` と表示されていれば完了です。

### サーバーの起動

#### Amplify Sandbox

Amplify Sandbox サーバーを起動します。

[Amplify Sandbox とは？](https://aws.amazon.com/jp/blogs/news/team-workflows-amplify/)

```shell
cd /workspaces/amplify-gen2-workshop/todo-app
npx ampx sandbox
```

Amplify Gen2 を開発するための Sandbox 環境が構築されます。

5 分程度かかりますので、お待ちください。

`File written: amplify_outputs.json` と表示されれば完了です。

#### Vite

次に、Vite 開発サーバーを起動します。

```shell
# 新しいターミナルを起動
cd /workspaces/amplify-gen2-workshop/todo-app
npm run dev

➜  Local:   http://localhost:5173/
```

`ブラウザーで開く` をクリックすると、別タブでアプリが表示されます。

別タブで `Vite + React` と記載されたページが表示されれば完了です。

このアプリを改良して Todo アプリにします。

## Kiro CLI によるコーディング支援

Kiro CLI を使用してアプリを作成していきます。

**作業目安：15分**

### ログイン画面

まず、ログイン画面を実装します。

```shell
kiro-cli
>
Amplify UI でログイン画面を作成してください。
最初に AWS MCP サーバーの Amplify ガイド付きワークフローを確認してください。
次に状況を確認して実装に移ってください。現在の状況は以下の通りです。

## プロジェクトセットアップ
* `npm create vite@latest todo-app -- --template react-ts`
* `npm create amplify@latest -- --template react-vite`

## 開発サーバー
* `npm run start` : Vite サーバーの起動
* `npx ampx sandbox` : Amplify Sandbox サーバーの起動

日本語で回答してください。
不要なファイルは削除してから作業を開始してください。
```

別タブで表示されているアプリにログイン画面が表示されれば完了です。
サインアップまで済ませておきましょう。

> [!NOTE]
>
> ログイン画面が完成したブランチを用意しています。
>
> Kiro による編集に失敗した場合は、`workshop/create-login` ブランチを利用してください。

### Todo 機能

次に Todo 機能を追加します。

```shell
kiro-cli
>
Todo 機能を追加してください。

## 必要な機能
必要な機能は以下の通りです。

* ユーザーが自分の Todo を CRUD できる
* ユーザーが他の人の Todo を Read できる
* Todo には以下の項目が存在する
    * title: string
    * content: string
    * status: enum[pending, in_progress, completed]
    * category: string[]

## 実装手順
以下の順で実装してください

1. `amplify/` ディレクトリ以下を修正し、バックエンドを実装する
2. `src/` ディレクトリ以下を修正し、フロントエンドを実装する

日本語で回答してください。
```

**バックエンド**

`amplify/` 以下のファイル変更を検知して、Sandbox サーバが自動的にデプロイ開始してくれます。
エラーメッセージなく `File written: amplify_outputs.json` 表示が完了していることを確認してください。

**フロントエンド**

Todo アプリが表示されれば完了です。

実際にアプリを使用して、動作に問題がないことを確認しましょう。

> [!TIP]
>
> Sandbox 環境のデータは AWS の各種リソースに実際に保存されます。
>
> 例えば、Todo アプリで追加したアイテムは DynamoDB の Todo テーブルに保存されているはずです。

問題なければ、ここまでの成果をコミットしておきましょう。

> [!NOTE]
>
> Todo アプリを追加したブランチを用意しています。
>
> Kiro による編集に失敗した場合は、`workshop/create-todo-app` ブランチを利用してください。

### デザイン修正

> [!IMPORTANT]
>
> 時間に余裕がある場合は、本項に取り組んでください。
>
> スキップして次のステップ（[docs/3\_ホスティング.md](3_ホスティング.md)）に進むことも可能です。

Kiro CLI にデザインを整えてもらいます。

```shell
# kiro-cli を一度 Ctrl+D で停止して、再起動させてください。

kiro-cli
>/plan

[plan] >
Todo アプリのデザインを整えて欲しいです。

* フロントエンドコードを修正してモダンなスタイルに修正してください。
* UI ライブラリには Amplify UI を利用してください。
* ヘッダーやサイドバーがある PC 向けアプリが希望です。

日本語で回答してください。

# いくつかの質問に答えたら、自動で計画を作成してくれます。
# 例：1=a, 2=a, 3=a
```

完成イメージの例

![README](img/README01.png)

最後に成果をコミットしておきましょう。

> [!NOTE]
>
> デザインを調整したブランチを用意しています。
>
> Kiro による編集に失敗した場合は、`workshop/created` ブランチを利用してください。

ここまで確認できたら、次のステップ（[docs/3\_ホスティング.md](3_ホスティング.md)）に進んでください。
